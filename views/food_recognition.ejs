<%- include("parts/html-head") %>
<%- include("parts/navbars") %>

<style>
  body {
    margin: 85px;
    margin-top: 10px;
  }

  form-group {
    border: 5px
  }

  table {
    width: "200px";
  }

  div.table-responsive {
    width: 800px;
  }

  /* #upload {
    width: 550px;
  } */
</style>


<div class="row justify-content-center mt-4">
  <img width="800px" height="400px" alt="Image" src="/img/ai04.jpg">
</div>


<div class="container mt-5">

  <div class="row justify-content-between">
    <div class="col-lg-5">
      <div class="card bg-info text-white shadow">
        <div class="card-body">
          
          <div class="row justify-content-between">
            <div class="col-lg-6"><h2>File Upload</h2></div>  
            <div class="col-lg-4"><svg width="3em" height="2em" viewBox="0 0 16 16" class="bi bi-cloud-upload" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383z"/>
              <path fill-rule="evenodd" d="M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3z"/>
            </svg>
            </div>
          </div>
          
        </div>
      </div>
    </div>


    <div class="col-lg-7">
      <div class="card bg-primary text-white shadow">
        <div class="card-body">
          
          <div class="row justify-content-between">
            <div class="col-lg-6"><h2>營養標示</h2></div>  
            <div class="col-lg-4"><svg width="3em" height="2em" viewBox="0 0 16 16" class="bi bi-menu-up" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M15 3.207v9a1 1 0 0 1-1 1h-3.586A2 2 0 0 0 9 13.793l-1 1-1-1a2 2 0 0 0-1.414-.586H2a1 1 0 0 1-1-1v-9a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1zm-13 11a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-3.586a1 1 0 0 0-.707.293l-1.353 1.354a.5.5 0 0 1-.708 0L6.293 14.5a1 1 0 0 0-.707-.293H2z"/>
              <path fill-rule="evenodd" d="M15 5.207H1v1h14v-1zm0 4H1v1h14v-1zm-13-5.5a.5.5 0 0 0 .5.5h6a.5.5 0 1 0 0-1h-6a.5.5 0 0 0-.5.5zm0 4a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 0-1h-11a.5.5 0 0 0-.5.5zm0 4a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 0-1h-8a.5.5 0 0 0-.5.5z"/>
            </svg>
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>


  <div class="row justify-content-between">

    <div class="col-lg-5 mb-4">
      <div class="card border-top-primary shadow h-100 py-2">
        <div class="card-body">          
          <form name="form1" onsubmit="return formCheck()">
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <span class="input-group-text">Upload</span>
              </div>
              <div class="custom-file">
                <label class="custom-file-label" for="food">Choose file</label>
                <input type="file" class="custom-file-input" accept="" id="food" name="food">
              </div>
            </div>
          </form>
        </div>
        <!-- <div class="card-body"> -->
        <div class="row">
          <img id="myimg" width="100%" src="" alt="">
        </div>
      </div>
    </div>


    <div class="col-lg-7 mb-4">
      <div class="card border-left-primary shadow h-100 py-2">
        <div class="card-body">
          <table id='nutri' class="table table-striped table-sm">
            <thead>
              <tr>
                <th>熱量</th>
                <th>蛋白質</th>
                <th>脂肪</th>
                <th>碳水化合物</th>
              </tr>
            </thead>
            <tbody>
              <tr class="table-active">
                <td id="fat"></td>
                <td id="carbs"></td>
                <td id="protein"></td>
                <td id="cal"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>




<div class="container">

  <div class="row justify-content-between">
    <div class="col-lg-6">
      <div class="card bg-success text-white shadow">

        <div class="card-body">

          <div class="row justify-content-between">
            <div class="col-lg-6"><h2>個人資料</h2></div>  
            <div class="col-lg-4"><svg width="3em" height="2em" viewBox="0 0 16 16" class="bi bi-person-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M14 1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
              <path fill-rule="evenodd" d="M2 15v-1c0-1 1-4 6-4s6 3 6 4v1H2zm6-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
            </svg>
            </div>
          </div>
        </div>

      </div>
    </div>


    <div class="col-lg-6">
      <div class="card bg-secondary text-white shadow">
        <div class="card-body">
          
          <div class="row justify-content-between">
            <div class="col-lg-6"><h2>熱量計算</h2></div>  
            <div class="col-lg-4"><svg width="3em" height="2em" viewBox="0 0 16 16" class="bi bi-calculator-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm2 .5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-2zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zM4.5 9a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM4 12.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zM7.5 6a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM7 9.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm.5 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM10 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm.5 2.5a.5.5 0 0 0-.5.5v4a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-.5-.5h-1z"/>
            </svg>
            </div>
          </div>
          
        
        </div>
      </div>
    </div>
  </div>



  <div class="row justify-content-between">

    <div class="col-lg-6 mb-4">
      <div class="card border-top-primary shadow h-100 py-2">
        <div class="card-body">

          <div class="col-lg-6 mt-2">
            <h2><label for="gender_sel">Gender</label></h2>
            <select class="custom-select" id="gender_sel" required>
              <option selected disabled value="">Choose...</option>
              <option value="m">Male</option>
              <option value="f">Female</option>
            </select>
          </div>

          <div class="col-lg-5 mt-2">
            <h2><label for="age_sel">Age</label></h2>
            <select class="custom-select" id="age_sel" required>
              <option selected disabled value="">Choose...</option>
              <option value="500">10~20</option>
              <option value="300">20~30</option>
              <option value="200">30~40</option>
              <option value="100">40~50</option>
              <option value="50">50~60</option>
              <option value="50">60~70</option>
              <option value="50">70~80</option>
            </select>
          </div>

          <div class="col-lg-4 mt-2">
            <h2><label for="level_sel">Level</label></h2>
            <select class="custom-select" id="level_sel" required>
              <option selected disabled value="">Choose...</option>
              <option value="1">Light</option>
              <option value="2">Normal</option>
              <option value="3">Hard</option>
            </select>
          </div>

        </div>
      </div>
    </div>

    <div class="col-lg-6 mb-4">
      <div class="card border-top-primary shadow h-100 py-2">
        <div class="card-body">
          <div class="col-lg-8 mt-2">
            <h2><label class="text-warning" for="validationCustom04">可吸收熱量 :</label></h2>
            <u>
             <div class="row justify-content-end h3" id="my_info"></div>
            </u>
          </div>

          <div class="col-lg-8 mt-2">
            <h2><label class="text-danger" for="validationCustom04">剩餘熱量 :</label></h2>
            <u>
              <div class="row justify-content-end h3" id="my_lastinfo"></div>
            </u>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>




<script src="/js/jquery-3.5.1.js"></script>
<script src="/bootstrap/js/bootstrap.bundle.js"></script>
<!-- <script>

          console.log("loading page1")
        
            function formCheck(){
              console.log("exec formCheck")
                $.post(
                    '/try-upload',
                    $(document.form1).serialize(),
                    function(data){
                      console.log('ajax response OK')
                        console.log(data);
                }, 'json')
                return false;
            }
        
      </script> -->



 <script>
        function formCheck() {
          const fd = new FormData(document.form1);  //FormData就是一個表單但沒有外觀
          fetch('/try-upload', {
            method: 'POST',
            body: fd
          })
            .then(r => r.json()) //拿文字的話json改text
            .then(obj => {
              console.log(obj)
              myimg.src = "/img-downloads/" + obj.filename;

              console.log(obj.data) //拿到data
              d = obj.data.match(/{.+}/)[0].replaceAll("\'", '"')
              console.log(d)
              d = JSON.parse(d)
              console.log(d)
              console.log(d.total_fat)

              console.log(document.querySelector('#nutri tbody tr td').innerText)
              //document.querySelector("#nutri tbody tr td").innerText = d.total_fat
              document.querySelector("#fat").innerText = d.total_cal
              document.querySelector("#carbs").innerText = d.total_protein
              document.querySelector("#protein").innerText = d.total_fat
              document.querySelector("#cal").innerText = d.total_carbs
            })

          return false;
        }

        food.addEventListener('change', formCheck)


        $('.dropdown-toggle').dropdown();
      </script>


      <!-- <script>
              function formCheck() {
                const fd = new FormData(document.form1);  //FormData就是一個表單但沒有外觀
                fetch('/try-upload-multi', {
                  method: 'POST',
                  body: fd
                })
                .then(r => r.json()) //拿文字的話json改text
                .then(ar => {
                    console.log(ar)
                    const imgs = $('#imgs');

                    ar.forEach(f=>{
                        imgs.append(`<div><img src="/img-uploads/${f.filename}" alt=""></div>`)
                    })
                    //myimg.src = "/img-uploads/" + obj.filename;
                })
      
                return false;
              }
      
      
              myphoto.addEventListener('change', formCheck)
            </script> -->


<%- include("parts/scripts") %>

<script>
  const gender_sel = $('#gender_sel');
  const age_sel = $('#age_sel');
  const level_sel = $('#level_sel');


  $('.custom-select').change(function () {

    const g = gender_sel.val();
    //const a = age_sel.val();
    const a = age_sel.val() ? parseInt(age_sel.val()) : 0;
    const l = level_sel.val();

    let cal = g === 'm' ? 2000 : 1500;

    cal += a;
    cal += l * 200;


    $('#my_info').html(cal + "卡");
    $('#my_lastinfo').html(cal - parseFloat($('#fat').text()) + "卡");
  });


</script>

<%- include("parts/html-foot") %>
<%- include("parts/html-foot") %>
